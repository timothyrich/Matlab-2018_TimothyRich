function cl = CCGetCalibration(fname)% CCGetCalibration(fname);% This routine gets calibration information from a file% PASS IN:  filename OR leave black to use dialog box % RETURNS:  cl:  the calibration structure% 10/5/02	JP created % 10/7/02	expanded to 3 guns% 10/8/02	used realistic values from fitting Alex's gamma data% 10/10/02	added to noise1 from displaynoise10% 10/16/02	redid to allow other colors% 10/21/02	renamed EXGetCalibration and pulled out of larger code, added string argument, but not used yet% 10/23/02	renamed CLGetCalibration, now calculates "realized" background luminance% 10/25/02	revised again% 11/30/05	v2:  now reads file% 11/30/05	v3:  reads file as specified in call% 10/29/06	renamed CLGetCalibration to replace old version% 12/6/12   updated for OS10% 9/8/14    added check for calibration file error% 3/16/15   JP renamed CCGetCalibration and simplfied for use with 32 bit color (no cluts)if nargin == 0										% if no filename arg, get from dialog boxes	[cl.filename, filepath] = uigetfile('*.cal', 'Calibration file name?');	% get file name	cd(filepath);									% update current pathelse	cl.filename = fname;							% use passed filenameend;% read calibration file[fid,status] = fopen(cl.filename,'r');						% open file read onlyif status ~= 0    error('CCGetCalibration:  Problem opening calibration file');end;cl.internalfilename = fscanf(fid,'%s',[1,1]);		% get filename from inside of filecl.name = fscanf(fid,'%s',[1,1]);					% get lots of other thingscl.date = fscanf(fid,'%s',[1,1]);cl.author = fscanf(fid,'%s',[1,1]);cl.comment1 = fscanf(fid,'%s',[1,1]);cl.comment2 = fscanf(fid,'%s',[1,1]);cl.type = fscanf(fid,'%g\n',[1,1]);					% use type 1 for Cowan's 2 parameter power functioncl.maxlum = fscanf(fid,'%g\n',[1,1]);				% in cd/m2cl.minlum = fscanf(fid,'%g\n',[1,1]);				% in cd/m2 cl.maxred = fscanf(fid,'%g\n',[1,1]);				% in cd/m2 for each gun  cl.maxgreen = fscanf(fid,'%g\n',[1,1]);cl.maxblue = fscanf(fid,'%g\n',[1,1]);cl.r.p1 = fscanf(fid,'%g\n',[1,1]);					% first parameter of cowan's powerfunction for each guncl.r.p2 = fscanf(fid,'%g\n',[1,1]);					% second parameter of cowan's powerfunction for each guncl.g.p1 = fscanf(fid,'%g\n',[1,1]);cl.g.p2 = fscanf(fid,'%g\n',[1,1]);cl.b.p1 = fscanf(fid,'%g\n',[1,1]);cl.b.p2 = fscanf(fid,'%g\n',[1,1]);fclose(fid);										% close file% standard valuescl.gunmax = 255;									% standard for 8 bit clutscl.white = [255 255 255];                           % rgb best available whitecl.black = [0 0 0];									% rgb for best available black (ignores black level)cl.red = [255 0 0];									% rgb for best available redcl.green = [0 255 0];								% rgb for best available green cl.blue = [0 0 255];								% rgb for best available blue 